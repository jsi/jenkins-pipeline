stage '1'
parallel 'featuresApp-1': {
    node('Node-1') {
        echo "Workspace: ${env.WORKSPACE}"
        timestamps {
            echo "Build Tag: ${env.BUILD_TAG}"
        }
        git url: 'https://github.com/enonic/app-features'
        def v = version()
        if (v) {
            echo "Building version ${v}"
        }

    }
}, 'purpleJS-1': {
    node('Node-2') {
        timestamps {
            echo "Version: 0.1.${env.BUILD_NUMBER}"
        }
        echo "Java home: ${env.JAVA_HOME}"
        git url: 'https://github.com/purplejs/purplejs'
    }
}

stage '2'
parallel 'featuresApp-2': {
    node('Node-1') {
        sh "./gradlew build"
    }
}, 'purpleJS-2': {
    node('Node-2') {
        timestamps {
            echo 'Purple JS is awesome!'
        }
    }
}

node('Node-1') {
    stage '3'
    timestamps {
        echo 'Lad oss vederkveges af de gode afslutninger'
    }
}


def version() {
    def matcher = readFile('gradle.properties') =~ 'version = (.+)'
    matcher ? matcher[0][1] : null
}
