java.lang.String concat(String a, String b) {
    a + b;
}

stage ('1') {
    node('Node-1') {
            echo "Workspace: ${env.WORKSPACE}"
            timestamps {
                echo "Build Tag: ${env.BUILD_TAG}"
            }
            git url: 'https://github.com/enonic/app-features'
            def v = version()
            if (v) {
                def message = concat("Building version ", v)
                echo message
            }
        }
}

stage ('2') {
    node ('Node-1') {
            timestamps {
                echo "Version: 0.1.${env.BUILD_NUMBER}"
            }
            echo "Java home: ${env.JAVA_HOME}"
            git url: 'https://github.com/purplejs/purplejs'
    }
}

stage ('3') {
    node ('Node-1') {
        sh "./gradlew --daemon build"
        def dockerHome = tool 'M3'
        echo dockerHome
    }
}

def version() {
    def matcher = readFile('gradle.properties') =~ 'version = (.+)'
    matcher ? matcher[0][1] : null
}
